name: Go

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

       
jobs:
  build:
    strategy:
      matrix:
        go-version: [1.14, 1.15, 1.16]
    env:
      CGO_ENABLED: 0
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2      

    - name: Build s2c
      run: go install github.com/klauspost/compress/s2/cmd/s2c && go install github.com/klauspost/compress/s2/cmd/s2d && s2c -verify s2c && s2d s2c.s2 && rm s2c && rm s2d && rm s2c.s2
      
    - name: Vet
      run: go vet ./...

    - name: Test
      run: go test ./...

    - name: Test Noasm
      run: go test -tags=noasm ./...
      
    - name: Test Race
      run: CGO_ENABLED=1 go test -cpu=1,4 -short -race ./...
      

      
